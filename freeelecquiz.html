<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><title>Live Quiz</title></head>
<body>
  <div>
    <h2>Enter your details:</h2>
    <input id="name" placeholder="Your Name"><br>
    <input id="schedule" placeholder="Schedule"><br>
    <button id="startBtn">Start Quiz (wait 5 seconds)</button>
  </div>
  <div id="quizContainer" style="display:none"></div>
  <script>
  const sheetURL = "https://docs.google.com/spreadsheets/d/1GzWimNcy3EP08pOoPGNk7rSDx48layBIjyR7-lTAXa8/gviz/tq?tqx=out:json&sheet=freeelecanswer1";
  const scriptURL = "https://script.google.com/macros/s/AKfycbxdugy3lh0kqK17Hmxq3tt2ABwBcBK7nMJEFpfUF_t2X_pePJpGSFpLW-IPgFPIIsNw2w/exec";
  let questions = [], current = 0, score = 0;
  const startBtn = document.getElementById("startBtn"), container = document.getElementById("quizContainer");

  startBtn.onclick = () => {
    const name = document.getElementById("name").value, schedule = document.getElementById("schedule").value;
    if (!name || !schedule) return alert("Please fill both fields.");
    startBtn.disabled = true;
    startBtn.textContent = "Please waitâ€¦";
    setTimeout(() => initQuiz(name, schedule), 5000);
  };

  function initQuiz(name, schedule) {
    fetch(sheetURL)
      .then(r => r.text())
      .then(t => JSON.parse(t.substr(47).slice(0, -2)))
      .then(js => {
        questions = js.table.rows.slice(1).map(r => ({
          q: r.c[0]?.v,
          options: [r.c[1]?.v, r.c[2]?.v, r.c[3]?.v, r.c[4]?.v].filter(Boolean),
          a: r.c[5]?.v
        }));
        questions.sort(() => Math.random() - 0.5);
        container.style.display = 'block';
        renderQuestion(name, schedule);
      });
  }

  function renderQuestion(name, schedule) {
    if (current >= questions.length) return finishQuiz(name, schedule);
    const {q, options, a} = questions[current];
    container.innerHTML = `<div>${q}</div>` + options.map(opt => `<button onclick="choose(this, '${opt}', '${a}', '${name}', '${schedule}')">${opt}</button>`).join('');
  }

  window.choose = (btn, selected, correct, name, schedule) => {
    btn.disabled = true;
    if (selected === correct) score++;
    setTimeout(() => {
      current++; renderQuestion(name, schedule);
    }, 500);
  };

  function finishQuiz(name, schedule) {
    container.innerHTML = `<h3>Your score: ${score}/${questions.length}</h3>`;
    fetch(scriptURL, {
      method: 'POST',
      body: JSON.stringify({ name, schedule, score, date: new Date().toISOString().slice(0,10) }),
      headers: { 'Content-Type': 'application/json' }
    }).catch(console.error);
  }
  </script>
</body>
</html>
